<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sunscreen Selection | Pisa Pack</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 20px;
      background: #f7f9fc;
      color: #222;
      scroll-behavior: smooth;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2e7d32;
      text-align: center;
      margin: 15px 0;
    }
    .selection-info {
      text-align: center;
      background: #e8f5e9;
      padding: 15px;
      border-radius: 8px;
      margin: 0 auto 25px;
      max-width: 600px;
      border: 1px solid #c8e6c9;
    }
    .counter {
      display: inline-block;
      background: #2e7d32;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      text-align: center;
      line-height: 24px;
      font-weight: bold;
      margin: 0 5px;
    }
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .product-card {
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s;
      position: relative;
      cursor: pointer;
      background: white;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    }
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(46, 125, 50, 0.1);
    }
    .product-card.selected {
      border: 2px solid #2e7d32;
      background: #f0f7f0;
    }
    .product-card img {
      width: 100%;
      max-height: 160px;
      object-fit: contain;
      margin-bottom: 15px;
      border-radius: 8px;
    }
    .product-name {
      font-weight: 600;
      margin: 10px 0;
      font-size: 16px;
      color: #333;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .price-line {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 14px;
      margin-top: 10px;
    }
    .mrp {
      text-decoration: line-through;
      color: #777;
    }
    .final-price {
      font-size: 18px;
      font-weight: 700;
      color: #2e7d32;
    }
    .selected-badge {
      position: absolute;
      top: -10px;
      right: -10px;
      background: #2e7d32;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .selected .selected-badge {
      display: flex;
    }
    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 40px 0 20px;
    }
    .btn {
      padding: 14px 30px;
      border-radius: 30px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 16px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .btn-primary {
      background: #2e7d32;
      color: white;
      border: none;
      box-shadow: 0 4px 8px rgba(46, 125, 50, 0.3);
    }
    .btn-primary:hover {
      background: #1b5e20;
      transform: translateY(-2px);
    }
    .btn-primary:disabled {
      background: #a5d6a7;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .btn-secondary {
      background: white;
      color: #2e7d32;
      border: 2px solid #2e7d32;
      display: none; /* Initially hidden */
    }
    .btn-secondary:hover {
      background: #f0f7f0;
    }
    .whatsapp-section {
      margin-top: 50px;
      padding: 25px;
      background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
      border-radius: 12px;
      text-align: center;
      border: 1px dashed #81c784;
    }
    .whatsapp-btn {
      display: inline-flex;
      align-items: center;
      padding: 12px 25px;
      background: #25d366;
      color: white;
      border-radius: 30px;
      font-weight: bold;
      text-decoration: none;
      margin-top: 15px;
      transition: all 0.3s;
      box-shadow: 0 4px 8px rgba(37, 211, 102, 0.3);
    }
    .whatsapp-btn:hover {
      background: #128C7E;
      transform: translateY(-2px);
    }
    .whatsapp-btn i {
      margin-right: 10px;
      font-size: 20px;
    }
    .selection-summary {
      background: #e8f5e9;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      display: none;
    }
    .summary-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: #2e7d32;
      text-align: center;
    }
    .selected-products {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    .selected-item {
      background: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 14px;
      display: flex;
      align-items: center;
      border: 1px solid #c8e6c9;
    }
    .remove-item {
      margin-left: 8px;
      cursor: pointer;
      color: #f44336;
      font-weight: bold;
    }
    @media (max-width: 768px) {
      .product-grid {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      }
      .action-buttons {
        flex-direction: column;
        gap: 15px;
      }
      .btn {
        width: 100%;
      }
    }
    @media (max-width: 480px) {
      .product-grid {
        grid-template-columns: 1fr;
      }
      .selection-info {
        padding: 12px;
        font-size: 14px;
      }
    }
    .instructions {
      text-align: center;
      color: #666;
      margin: 10px 0 25px;
      font-style: italic;
    }
    .confirmation {
      text-align: center;
      background: #e8f5e9;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      display: none;
    }
    .selection-status {
      text-align: center;
      margin: 20px 0;
      font-weight: 600;
      color: #2e7d32;
    }
        @media (max-width: 768px) {
  .product-grid {
    grid-template-columns: repeat(2, 1fr); /* Changed to 2 columns */
    gap: 15px; /* Adjusted gap for mobile */
  }
  
  .product-card {
    padding: 15px; /* Slightly reduced padding for mobile */
  }
  
  .product-name {
    font-size: 14px; /* Slightly smaller font for mobile */
    min-height: 40px; /* Reduced min-height */
  }
  
  .action-buttons {
    flex-direction: column;
    gap: 15px;
  }
  
  .btn {
    width: 100%;
  }
}

@media (max-width: 480px) {
  .product-grid {
    grid-template-columns: repeat(2, 1fr); /* Ensure 2 columns on very small screens */
    gap: 10px; /* Even smaller gap on very small screens */
  }
  
  .product-card {
    padding: 12px; /* Further reduced padding */
  }
  
  .product-name {
    font-size: 13px; /* Smaller font for very small screens */
    min-height: 36px; /* Further reduced min-height */
  }
  
  .final-price {
    font-size: 16px; /* Slightly smaller price font */
  }
  
  .selection-info {
    padding: 10px;
    font-size: 14px;
  }
  
  /* Adjust image size for very small screens */
  .product-card img {
    max-height: 120px;
  }
}

/* Additional media query for extremely small screens */
@media (max-width: 360px) {
  .product-grid {
    gap: 8px; /* Minimal gap */
  }
  
  .product-card {
    padding: 8px; /* Minimal padding */
  }
  
  .product-name {
    font-size: 12px; /* Smallest readable font size */
  }
  
  .final-price {
    font-size: 14px;
  }
}
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <h1>Select Your Sunscreen</h1>
    
    <div class="selection-info">
      <p>Choose <strong>3 products</strong> from this category</p>
      <p class="instructions">(Click on products to select/deselect)</p>
      <div class="selection-status" id="selectionStatus">
        You can select up to <span id="remainingCount">3</span> more products
      </div>
    </div>
    
    <div class="selection-summary" id="selectionSummary">
      <div class="summary-title">Your Selection: <span id="selectedCount">0</span> products</div>
      <div class="selected-products" id="selectedProductsList"></div>
    </div>
    
    <div class="confirmation" id="confirmation">
      <i class="fas fa-check-circle" style="color: #2e7d32; font-size: 48px; margin-bottom: 15px;"></i>
      <h3>Products Added to Your Pack!</h3>
      <p>You can now proceed to the next category</p>
    </div>

    <div class="product-grid">
      <!-- Product 1 -->
      <div class="product-card" data-name="Mamaearth vitamin c daily glow (orange)" data-mrp="349" data-price="310" data-image="ss1.jpg">
        <img src="ss1.jpg" alt="Sunscreen">
        <div class="product-name">Mamaearth vitamin c daily glow (orange)</div>
        <div class="price-line">
          <span class="mrp">₹349</span>
          <span class="final-price">₹310</span>
        </div>
        <div class="selected-badge">1</div>
      </div>

      <!-- Product 2 -->
      <div class="product-card" data-name="Mamaearth vitamin c daily glow (beatroot)" data-mrp="399" data-price="320" data-image="ss2.jpg">
        <img src="ss2.jpg" alt="Sunscreen">
        <div class="product-name">Mamaearth vitamin c daily glow (beatroot)</div>
        <div class="price-line">
          <span class="mrp">₹399</span>
          <span class="final-price">₹320</span>
        </div>
        <div class="selected-badge">2</div>
      </div>

      <!-- Product 3 -->
      <div class="product-card" data-name="Lakme sun expert 9 to 5 supermate" data-mrp="369" data-price="299" data-image="ss3.jpg">
        <img src="ss3.jpg" alt="Sunscreen">
        <div class="product-name">Lakme sun expert 9 to 5 supermate</div>
        <div class="price-line">
          <span class="mrp">₹369</span>
          <span class="final-price">₹299</span>
        </div>
        <div class="selected-badge">3</div>
      </div>

      <!-- Product 4 -->
      <div class="product-card" data-name="Dot & key vitamin C+E sunscreen" data-mrp="445" data-price="370" data-image="ss4.jpg">
        <img src="ss4.jpg" alt="Sunscreen">
        <div class="product-name">Dot & key vitamin C+E sunscreen</div>
        <div class="price-line">
          <span class="mrp">₹445</span>
          <span class="final-price">₹370</span>
        </div>
        <div class="selected-badge">4</div>
      </div>

      <!-- Product 5 -->
      <div class="product-card" data-name="Ponds sun miracle 55 spf sunscreen" data-mrp="299" data-price="260" data-image="ss5.jpg">
        <img src="ss5.jpg" alt="Sunscreen">
        <div class="product-name">Ponds sun miracle 55 spf sunscreen</div>
        <div class="price-line">
          <span class="mrp">₹299</span>
          <span class="final-price">₹260</span>
        </div>
        <div class="selected-badge">5</div>
      </div>

      <!-- Product 6 -->
      <div class="product-card" data-name="Aqualogica glow papaya vitamin c sunscreen" data-mrp="449" data-price="360" data-image="ss6.jpg">
        <img src="ss6.jpg" alt="Sunscreen">
        <div class="product-name">Aqualogica glow papaya vitamin c sunscreen</div>
        <div class="price-line">
          <span class="mrp">₹449</span>
          <span class="final-price">₹360</span>
        </div>
        <div class="selected-badge">6</div>
      </div>
    </div>

    <div class="action-buttons">
      <button class="btn btn-primary" id="addToCartBtn" disabled>
        <i class="fas fa-shopping-cart"></i> Add Selected to Cart
      </button>
      <button class="btn btn-secondary" id="pickNextBtn">
        <i class="fas fa-arrow-right"></i> Pick Next Category
      </button>
    </div>

    <!-- WhatsApp Section -->
    <div class="whatsapp-section">
      <h3>Don't see your preferred brand?</h3>
      <p>We can arrange your favourite brand! Ask us and we will get it for you.</p>
      <a href="https://wa.me/917893553115?text=I%20need%20some%20other%20brand%20product" class="whatsapp-btn" target="_blank">
        <i class="fab fa-whatsapp"></i> Ask & Get
      </a>
    </div>
  </div>


    <script>
    // Constants
    const MAX_TOTAL_PRODUCTS = 5;
    const maxSelections = 3; // Change to 1 for product5.html (rose water)
    const currentCategory = 'sunscreen'; // Change for each page: 'facewash', 'sunscreen', 'moisturizer', 'serum', 'rosewater'
    
    // DOM Elements
    const productCards = document.querySelectorAll('.product-card');
    const addToCartBtn = document.getElementById('addToCartBtn');
    const pickNextBtn = document.getElementById('pickNextBtn');
    const selectionSummary = document.getElementById('selectionSummary');
    const selectedProductsList = document.getElementById('selectedProductsList');
    const selectedCount = document.getElementById('selectedCount');
    const confirmation = document.getElementById('confirmation');
    const selectionStatus = document.getElementById('selectionStatus');
    const remainingCount = document.getElementById('remainingCount');
    const selectionInfo = document.querySelector('.selection-info');
    
    let selectedProducts = [];

    // NEW: Function to sync selected products to localStorage
    function syncSelectedToLocalStorage() {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        // Remove existing products from this category
        cart = cart.filter(item => item.category !== currentCategory);
        
        // Add current selections
        cart.push(...selectedProducts);
        
        localStorage.setItem('cart', JSON.stringify(cart));
        
        // Update global count display
        updateGlobalCountDisplay();
        
        // Send message to parent window to update highlights if needed
        if (window.opener) {
            window.opener.postMessage({ type: 'updateHighlights' }, '*');
        } else {
            window.postMessage({ type: 'updateHighlights' }, '*');
        }
    }

    // NEW: Check if pack is full
    function isPackFull() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        return cart.length >= MAX_TOTAL_PRODUCTS;
    }

    // NEW: Check if user can select more
    function canSelectMore() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const currentCategoryItems = cart.filter(item => item.category === currentCategory);
        const otherCategoryItems = cart.filter(item => item.category !== currentCategory);
        const availableSlots = MAX_TOTAL_PRODUCTS - cart.length;
        
        // Allow if there's space OR if replacing existing items (but not exceeding global limit)
        const wouldBeTotal = otherCategoryItems.length + selectedProducts.length;
        return (availableSlots > 0 && wouldBeTotal < MAX_TOTAL_PRODUCTS) || 
               (currentCategoryItems.length > 0 && wouldBeTotal <= MAX_TOTAL_PRODUCTS);
    }

    // NEW: Show pack status
    function updateGlobalCountDisplay() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const currentCount = cart.filter(item => item.category === currentCategory).length;
        const totalCount = cart.length;
        const remaining = MAX_TOTAL_PRODUCTS - totalCount;
        
        if (remaining > 0) {
            selectionStatus.innerHTML = `
                You've selected ${selectedProducts.length} of max ${maxSelections} from this category<br>
                <small>(${remaining} slots remaining in your pack)</small>
            `;
        } else {
            selectionStatus.innerHTML = `
                You've selected ${selectedProducts.length} of max ${maxSelections} from this category<br>
                <small style="color: #f44336;">(Your pack is full! You can only replace items in this category)</small>
            `;
        }
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function () {
        // Load any existing selections from cart
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const currentCategoryProducts = cart.filter(item => item.category === currentCategory);
        
        if (currentCategoryProducts.length > 0) {
            selectedProducts = [...currentCategoryProducts];
            updateSelections();
        }
        
        // Update remaining count display
        updateRemainingCount();
        
        // NEW: Check pack status on load
        const otherCategoryItems = cart.filter(item => item.category !== currentCategory);
        
        if (cart.length >= MAX_TOTAL_PRODUCTS) {
            const currentCategoryItems = cart.filter(item => item.category === currentCategory);
            
            if (currentCategoryItems.length === 0) {
                selectionInfo.innerHTML = `
                    <h3 style="color: #f44336;">Your Pack is Full!</h3>
                    <p>You've already selected ${MAX_TOTAL_PRODUCTS} products. Please remove some items from your pack to select more.</p>
                    <a href="index.html" class="btn btn-primary" style="margin-top: 10px; display: inline-block;">
                        <i class="fas fa-shopping-cart"></i> View Your Pack
                    </a>
                `;
                
                // Disable all product cards
                productCards.forEach(card => {
                    card.style.opacity = '0.6';
                    card.style.cursor = 'not-allowed';
                    card.style.pointerEvents = 'none';
                });
                
                // Disable add to cart button
                addToCartBtn.disabled = true;
            } else {
                // Allow replacement but prevent adding more than the global limit
                selectionInfo.innerHTML = `
                    <p>Your pack is full! You can replace items in this category but cannot exceed ${MAX_TOTAL_PRODUCTS} total products.</p>
                    <p>Choose <strong>up to ${maxSelections} products</strong> from this category (replacement only)</p>
                `;
            }
        }
        
        // NEW: Update global count display
        updateGlobalCountDisplay();
    });

    // Update remaining products count
    function updateRemainingCount() {
        const remaining = maxSelections - selectedProducts.length;
        remainingCount.textContent = remaining;
        
        if (remaining === 0) {
            selectionStatus.innerHTML = 'You have selected the maximum of ' + maxSelections + ' products';
        } else {
            selectionStatus.innerHTML = `You can select up to <span id="remainingCount">${remaining}</span> more products`;
        }
    }

    // Product selection handler
    productCards.forEach(card => {
        card.addEventListener('click', function() {
            // NEW: Check if user can select more (global limit)
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const currentCategoryItems = cart.filter(item => item.category === currentCategory);
            const otherCategoryItems = cart.filter(item => item.category !== currentCategory);
            
            // Calculate how many new items would be added
            const productName = this.dataset.name;
            const isAlreadySelected = selectedProducts.findIndex(p => p.name === productName) !== -1;
            
            // If not already selected, check if adding would exceed global limit
            if (!isAlreadySelected) {
                const wouldAddCount = selectedProducts.length + (isAlreadySelected ? 0 : 1);
                const newTotalCount = otherCategoryItems.length + wouldAddCount;
                
                if (newTotalCount > MAX_TOTAL_PRODUCTS) {
                    alert(`You cannot exceed the maximum of ${MAX_TOTAL_PRODUCTS} products in your pack. Please remove some items from other categories first.`);
                    return;
                }
            }
            
            // NEW: Check if user can select more (category limit)
            if (!canSelectMore()) {
                alert('Your pack is full! Please remove some items before adding more.');
                return;
            }
            
            const productPrice = parseFloat(this.dataset.price);
            const productImage = this.dataset.image;
            const mrp = parseFloat(this.dataset.mrp);
            
            // Check if product is already selected
            const index = selectedProducts.findIndex(p => p.name === productName);
            
            if (index !== -1) {
                // Remove product if already selected
                selectedProducts.splice(index, 1);
                this.classList.remove('selected');
            } else {
                // Add product if not already selected and under limit
                if (selectedProducts.length < maxSelections) {
                    selectedProducts.push({
                        name: productName,
                        price: productPrice,
                        mrp: mrp,
                        image: productImage,
                        category: currentCategory
                    });
                    this.classList.add('selected');
                } else {
                    alert('You can select maximum ' + maxSelections + ' products from this category');
                }
            }
            
            updateSelections();
            updateRemainingCount();
            // NEW: Sync to localStorage immediately
            syncSelectedToLocalStorage();
        });
    });

    // Update UI based on selections
    function updateSelections() {
        // Update badge numbers on product cards
        productCards.forEach(card => {
            const badge = card.querySelector('.selected-badge');
            const productName = card.dataset.name;
            const index = selectedProducts.findIndex(p => p.name === productName);
            
            if (index !== -1) {
                badge.textContent = index + 1;
                card.classList.add('selected');
            } else {
                badge.textContent = '';
                card.classList.remove('selected');
            }
        });
        
        // Update selection summary
        if (selectedProducts.length > 0) {
            selectionSummary.style.display = 'block';
            selectedCount.textContent = selectedProducts.length;
            
            // Update selected products list
            selectedProductsList.innerHTML = '';
            selectedProducts.forEach((product, index) => {
                const item = document.createElement('div');
                item.className = 'selected-item';
                item.innerHTML = `
                    ${index + 1}. ${product.name} 
                    <span class="remove-item" data-name="${product.name}">×</span>
                `;
                selectedProductsList.appendChild(item);
            });
            
            // Enable/disable Add to Cart button
            addToCartBtn.disabled = false;
        } else {
            selectionSummary.style.display = 'none';
            addToCartBtn.disabled = true;
        }
        
        // Add event listeners to remove buttons
        document.querySelectorAll('.remove-item').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                const productName = this.dataset.name;
                const index = selectedProducts.findIndex(p => p.name === productName);
                
                if (index !== -1) {
                    selectedProducts.splice(index, 1);
                    
                    // Also remove selection from product card
                    productCards.forEach(card => {
                        if (card.dataset.name === productName) {
                            card.classList.remove('selected');
                        }
                    });
                    
                    updateSelections();
                    updateRemainingCount();
                    // NEW: Sync to localStorage immediately
                    syncSelectedToLocalStorage();
                }
            });
        });
        
        // NEW: Update global count display
        updateGlobalCountDisplay();
    }

    // Show the "Pick Next Category" button
    function showPickNextButton() {
        addToCartBtn.style.display = 'none';
        pickNextBtn.style.display = 'inline-flex';
        confirmation.style.display = 'block';
        selectionSummary.style.display = 'none';
    }

    // Add to Cart button handler
    addToCartBtn.addEventListener('click', function () {
        if (selectedProducts.length === 0) return;
        
        // Since we're already syncing to localStorage on every change,
        // we just need to show the confirmation UI
        showPickNextButton();
    });

    // Next button handler
    pickNextBtn.addEventListener('click', function () {
        window.location.href = 'index.html#emptyBoxes';
    });
  </script>
</body>
</html>